df_Sub_coppel <- df_coppel[c(producto4,producto5,producto6),]
rm(df_Sub_ekt)
sapply(df_ekt$Nombre, extrae_tamano_ekt)
sapply(df_ekt$Nombre[1], extrae_tamano_ekt)
cadena <- df_ekt$Nombre[1]
cadena
cadena <- df_ekt$Nombre[3]
cadena
cadena <- df_ekt$Nombre[10]
cadena
cadena <- df_ekt$Nombre[100]
cadena
hu <- grep("Pantalla",cadena, ignore.case = T)
hu
he <- grep("Lavadora",cadena, ignore.case = T)
he
ho <- grep("Refrigerador",cadena,ignore.case = T)
hu
cadena
ho
extrae_tamano_ekt(cadena)
View(df_ekt)
cadena <- df_ekt$Nombre[19]
extrae_tamano_ekt(cadena)
extrae_tamano_ekt <- function(cadena){
hu <- grep("Pantalla",cadena, ignore.case = T)
ho <- grep("Refrigerador",cadena,ignore.case = T)
he <- grep("Lavadora",cadena, ignore.case = T)
ja = NA
if (length(hu) !=0){
ja <- stri_extract_all(str = cadena, regex = "[0-9]+ *pulgadas")
}
if (length(ho) !=0){
ju <- stri_extract_all(regex = '\\d+( ?)pies',
str = cadena,
case_insensitive = TRUE) %>%
stri_extract_all(regex = "[0-9]+")
ja <- ifelse(is.na(ju), NA, paste(ju, "pies"))
}
if (length(he) !=0){
ju <- stri_extract_all(regex = '\\d+( ?)kg',
str = cadena,
case_insensitive = TRUE) %>%
stri_extract_all(regex = "[0-9]+")
ja <- ifelse(is.na(ju), NA, paste(ju, "Kg"))
}
return(ja)
}
sapply(df_ekt$Nombre, extrae_tamano_ekt)
sapply(df_ekt$Nombre, extrae_tamano_ekt) %>% unique
sapply(df_ekt$Nombre, extrae_tamano_ekt) %>% unique %>% sort
sapply(df_ekt$Nombre, extrae_tamano_ekt) %>% unique %>% unlist
extrae_tamano_ekt <- function(cadena){
hu <- grep("Pantalla",cadena, ignore.case = T)
ho <- grep("Refrigerador",cadena,ignore.case = T)
he <- grep("Lavadora",cadena, ignore.case = T)
ja = NA
if (length(hu) !=0){
ja <- stri_extract_all(str = cadena, regex = "[0-9]+ *pulgadas")
}
if (length(ho) !=0){
ju <- stri_extract_all(regex = '\\d+ *pies',
str = cadena,
case_insensitive = TRUE) %>%
stri_extract_all(regex = "[0-9]+")
ja <- ifelse(is.na(ju), NA, paste(ju, "pies"))
}
if (length(he) !=0){
ju <- stri_extract_all(regex = '\\d+ *kilos',
str = cadena,
case_insensitive = TRUE) %>%
stri_extract_all(regex = "[0-9]+")
ja <- ifelse(is.na(ju), NA, paste(ju, "Kg"))
}
return(ja)
}
sapply(df_ekt$Nombre, extrae_tamano_ekt) %>% unique %>% unlist
df_ekt$marca <- sapply(df_ekt$Nombre,
function(cadena) extrae_marca(cadena, marcas))
df_ekt$Producto <- sapply(df_ekt$Nombre,
function(art) tipo_producto(art))
df_ekt$tamano <- sapply(df_ekt$Nombre,
function(cadena) extrae_tamano_ekt(cadena))
source("utils.R")
df_ekt$marca <- sapply(df_ekt$Nombre,
function(cadena) extrae_marca(cadena, marcas))
df_ekt$Producto <- sapply(df_ekt$Nombre,
function(art) tipo_producto(art))
sapply(df_ekt$Nombre,
function(cadena) extrae_marca(cadena, marcas))
cadena
extrae_marca(cadena, marcas)
kl <- as.list(strsplit(cadena,  " ")[[1]]) %>%
toupper()
as.list(strsplit(cadena,  " ")[[1]])
?strsplit
as.list(strsplit(cadena,  " ")[[1]]) %>%
toupper()
strsplit(cadena,  " ")[[1]]
strsplit(cadena,  " ")
strsplit(as.character(cadena),  " ")
extrae_marca <- function(cadena, marcas){
kl <- as.list(strsplit(as.character(cadena),  " ")[[1]]) %>%
toupper()
m <- gsub("[^A-Za-z0-9ñÑ-]", "", kl)
vb <- intersect(marcas, m)
if(length(vb) == 0) vb = NA
return(vb)
}
extrae_marca(cadena, marcas)
sapply(df_ekt$Nombre,
function(cadena) extrae_marca(cadena, marcas))
tipo_producto <- function(art){
hu <- grep("Pantalla", as.character(art), fixed = T)
ho <- grep("Refrigerador", as.character(art), fixed = T)
he <- grep("Lavadora", as.character(art), fixed = T)
if(length(hu) != 0){
pr <- "Pantalla"
}
if(length(ho) != 0){
pr <- "Refrigerador"
}
if(length(he) != 0){
pr <- "Lavadora"
}
return(pr)
}
df_ekt$tamano <- sapply(df_ekt$Nombre,
function(cadena) extrae_tamano_ekt(cadena))
df_ekt$Producto <- sapply(df_ekt$Nombre,
function(art) tipo_producto(art))
tipo_producto <- function(art){
hu <- grep("Pantalla", as.character(art), fixed = T)
ho <- grep("Refrigerador", as.character(art), fixed = T)
he <- grep("Lavadora", as.character(art), fixed = T)
pr = NA
if(length(hu) != 0){
pr <- "Pantalla"
}
if(length(ho) != 0){
pr <- "Refrigerador"
}
if(length(he) != 0){
pr <- "Lavadora"
}
return(pr)
}
df_ekt$Producto <- sapply(df_ekt$Nombre,
function(art) tipo_producto(art))
df_ekt$marca <- sapply(df_ekt$Nombre,
function(cadena) extrae_marca(cadena, marcas))
df_ekt$Producto <- sapply(df_ekt$Nombre,
function(art) tipo_producto(art))
df_ekt$tamano <- sapply(df_ekt$Nombre,
function(cadena) extrae_tamano_ekt(cadena))
View(df_ekt)
extrae_tamano_ekt <- function(cadena){
hu <- grep("Pantalla",cadena, ignore.case = T)
ho <- grep("Refrigerador",cadena,ignore.case = T)
he <- grep("Lavadora",cadena, ignore.case = T)
ja <- NA
if (length(hu) !=0){
ja <- stri_extract_all(str = cadena, regex = "[0-9]+ *pulgadas")
}
if (length(ho) !=0){
ju <- stri_extract_all(regex = '\\d+ *pies',
str = cadena,
case_insensitive = TRUE) %>%
stri_extract_all(regex = "[0-9]+")
ja <- ifelse(is.na(ju), NA, paste(ju, "pies"))
}
if (length(he) !=0){
ju <- stri_extract_all(regex = '\\d+ *kilos',
str = cadena,
case_insensitive = TRUE) %>%
stri_extract_all(regex = "[0-9]+")
ja <- ifelse(is.na(ju), NA, paste(ju, "Kg"))
}
return(ja)
}
df_ekt$tamano <- sapply(df_ekt$Nombre,
function(cadena) extrae_tamano_ekt(cadena))
df_ekt$tamano[1]
is.na(df_ekt$tamano[1])
filter(df_ekt, complete.cases(.)) %>% View
df_ekt %>% filter(complete.cases(.)) %>% View
extrae_tamano_ekt <- function(cadena){
hu <- grep("Pantalla",cadena, ignore.case = T)
ho <- grep("Refrigerador",cadena,ignore.case = T)
he <- grep("Lavadora",cadena, ignore.case = T)
ja <- NA
if (length(hu) !=0){
ju <- stri_extract_all(str = cadena, regex = "[0-9]+ *pulgadas")
ja <- ifelse(is.na(ju), NA, ju)
}
if (length(ho) !=0){
ju <- stri_extract_all(regex = '\\d+ *pies',
str = cadena,
case_insensitive = TRUE) %>%
stri_extract_all(regex = "[0-9]+")
ja <- ifelse(is.na(ju), NA, paste(ju, "pies"))
}
if (length(he) !=0){
ju <- stri_extract_all(regex = '\\d+ *kilos',
str = cadena,
case_insensitive = TRUE) %>%
stri_extract_all(regex = "[0-9]+")
ja <- ifelse(is.na(ju), NA, paste(ju, "Kg"))
}
return(ja)
}
df_ekt$marca <- sapply(df_ekt$Nombre,
function(cadena) extrae_marca(cadena, marcas))
df_ekt$Producto <- sapply(df_ekt$Nombre,
function(art) tipo_producto(art))
df_ekt$tamano <- sapply(df_ekt$Nombre,
function(cadena) extrae_tamano_ekt(cadena))
View(df_ekt)
df_ekt %>% filter(complete.cases(.)) %>% View
df_ekt$marca <- unlist(sapply(df_ekt$Nombre,
function(cadena) extrae_marca(cadena, marcas)))
df_ekt$tamano <- unlist(sapply(df_ekt$Nombre,
function(cadena) extrae_tamano_ekt(cadena)))
df_ekt %>% filter(complete.cases(.)) %>% View
View(df_Sub_coppel)
#para el data frame de coppel
df_Sub_coppel$marca <- sapply(df_Sub_coppel$Nombre,
function(cadena) extrae_marca(cadena, marcas))
df_Sub_coppel$Producto <- sapply(df_Sub_coppel$Nombre,
function(art) tipo_producto(art))
df_Sub_coppel$tamano <- sapply(df_Sub_coppel$Nombre,
function(cadena) extrae_tamano(cadena))
#para el data frame de famsa
df_Sub_famsa$marca <- sapply(df_Sub_famsa$Nombre_producto,
function(cadena) extrae_marca(cadena, marcas))
df_Sub_famsa$Producto <- sapply(df_Sub_famsa$Nombre_producto,
function(art) tipo_producto(art))
df_Sub_famsa$tamano <- sapply(df_Sub_famsa$Nombre_producto,
function(cadena) extrae_tamano(cadena))
cadena <- df_Sub_coppel$Nombre[3192]
df_Sub_coppel$Nombre[3192]
df_Sub_coppel$Nombre[13]
cadena <- df_Sub_coppel$Nombre[13]
cadena
strsplit(cadena, " ")
a <- strsplit(cadena, " ")[[1]]
a
a[-1]
a[length(a)]
a[length(a)] %>% stri_extract_all("\\d")
a[length(a)] %>% stri_extract_all("[0-9]+")
a[length(a)] %>% stri_extract_all(., "[0-9]+")
a[length(a)] %>% stri_extract_all(x = ., regex = "[0-9]+")
a[length(a)] %>% stri_extract_all(str = ., regex = "[0-9]+")
a[length(a)] %>% grep(str = ., regex = "[0-9]+")
a[length(a)] %>% grep("[0-9]+")
a[length(a)] %>% grep("[0-9]+", .)
a[length(a)] %>% grep("[0-9]+", ., value = T)
a[length(a)] %>% str_locate_all(x = ., regex = "[0-9]+")
a[length(a)] %>% str_locate_all("[0-9]+")
a[length(a)] %>% stri_extract_all(str = ., regex = "[0-9]+")
a[length(a)] %>% stri_extract_all(str = ., regex = "[0-9]+")[[1]]
b <- a[length(a)] %>% stri_extract_all(str = ., regex = "[0-9]+")
b[[1]][1]
substr(b[[1]][1], 1, 2)
extrae_tamano <- function(cadena){
hu <- grep("Pantalla",cadena, ignore.case = T)
ho <- grep("Refrigerador",cadena,ignore.case = T)
he <- grep("Lavadora",cadena, ignore.case = T)
if (length(hu) !=0){
ju <- as.character(unlist(stri_extract_all(cadena, regex = '([0-9]+")'))) %>%
stri_extract_all(regex = "[0-9]+")
if(is.na(ju)) {
a <- strsplit(cadena, " ")[[1]]
b <- a[length(a)] %>% stri_extract_all(str = ., regex = "[0-9]+")
ju <- substr(b[[1]][1], 1, 2)
}
ja <- ifelse(is.na(ju), NA, paste(ju, "pulgadas"))
}
if (length(ho) !=0){
ju <- stri_extract_all(regex = '\\d+( ?)p',
str = cadena,
case_insensitive = TRUE) %>%
stri_extract_all(regex = "[0-9]+")
ja <- ifelse(is.na(ju), NA, paste(ju, "pies"))
}
if (length(he) !=0){
ju <- stri_extract_all(regex = '\\d+( ?)kg',
str = cadena,
case_insensitive = TRUE) %>%
stri_extract_all(regex = "[0-9]+")
ja <- ifelse(is.na(ju), NA, paste(ju, "Kg"))
}
return(ja)
}
sapply(df_Sub_coppel$Nombre,
function(cadena) extrae_tamano(cadena))
sapply(df_Sub_coppel$Nombre,
function(cadena) extrae_tamano(cadena)) %>% unique() %>% sort
df_Sub_coppel$marca <- sapply(df_Sub_coppel$Nombre,
function(cadena) extrae_marca(cadena, marcas))
df_Sub_coppel$Producto <- sapply(df_Sub_coppel$Nombre,
function(art) tipo_producto(art))
df_Sub_coppel$tamano <- sapply(df_Sub_coppel$Nombre,
function(cadena) extrae_tamano(cadena))
#para el data frame de famsa
df_Sub_famsa$marca <- sapply(df_Sub_famsa$Nombre_producto,
function(cadena) extrae_marca(cadena, marcas))
df_Sub_famsa$Producto <- sapply(df_Sub_famsa$Nombre_producto,
function(art) tipo_producto(art))
df_Sub_famsa$tamano <- sapply(df_Sub_famsa$Nombre_producto,
function(cadena) extrae_tamano(cadena))
View(df_Sub_famsa)
extrae_tamano <- function(cadena){
hu <- grep("Pantalla", cadena, ignore.case = T)
ho <- grep("Refrigerador", cadena,ignore.case = T)
he <- grep("Lavadora", cadena, ignore.case = T)
if (length(hu) !=0){
ju <- as.character(unlist(stri_extract_all(cadena, regex = '([0-9]+")'))) %>%
stri_extract_all(regex = "[0-9]+")
if(is.na(ju)) {
a <- strsplit(cadena, " ")[[1]]
b <- a[length(a)] %>% stri_extract_all(str = ., regex = "[0-9]+")
ju <- substr(b[[1]][1], 1, 2)
}
ja <- ifelse(is.na(ju), NA, paste(ju, "pulgadas"))
}
if (length(ho) !=0){
ju <- stri_extract_all(regex = '\\d+( ?)p',
str = cadena,
case_insensitive = TRUE) %>%
stri_extract_all(regex = "[0-9]+")
ja <- ifelse(is.na(ju[1]), NA, paste(ju[1], "pies"))
}
if (length(he) !=0){
ju <- stri_extract_all(regex = '\\d+( ?)kg',
str = cadena,
case_insensitive = TRUE) %>%
stri_extract_all(regex = "[0-9]+")
ja <- ifelse(is.na(ju), NA, paste(ju, "Kg"))
}
return(ja)
}
df_Sub_coppel$marca <- sapply(df_Sub_coppel$Nombre,
function(cadena) extrae_marca(cadena, marcas))
df_Sub_coppel$Producto <- sapply(df_Sub_coppel$Nombre,
function(art) tipo_producto(art))
df_Sub_coppel$tamano <- sapply(df_Sub_coppel$Nombre,
function(cadena) extrae_tamano(cadena))
#para el data frame de famsa
df_Sub_famsa$marca <- sapply(df_Sub_famsa$Nombre_producto,
function(cadena) extrae_marca(cadena, marcas))
df_Sub_famsa$Producto <- sapply(df_Sub_famsa$Nombre_producto,
function(art) tipo_producto(art))
df_Sub_famsa$tamano <- sapply(df_Sub_famsa$Nombre_producto,
function(cadena) extrae_tamano(cadena))
which(df_Sub_famsa$sku == "PFE28RSHSS.ACE")
cadena <- df_Sub_famsa$Nombre_producto[44]
cadena
hu <- grep("Pantalla", cadena, ignore.case = T)
ho <- grep("Refrigerador", cadena,ignore.case = T)
he <- grep("Lavadora", cadena, ignore.case = T)
hu
ho
he
ju <- stri_extract_all(regex = '\\d+( ?)p',
str = cadena,
case_insensitive = TRUE) %>%
stri_extract_all(regex = "[0-9]+")
ju
extrae_tamano <- function(cadena){
hu <- grep("Pantalla", cadena, ignore.case = T)
ho <- grep("Refrigerador", cadena,ignore.case = T)
he <- grep("Lavadora", cadena, ignore.case = T)
if (length(hu) !=0){
ju <- as.character(unlist(stri_extract_all(cadena, regex = '([0-9]+")'))) %>%
stri_extract_all(regex = "[0-9]+")
if(is.na(ju)) {
a <- strsplit(cadena, " ")[[1]]
b <- a[length(a)] %>% stri_extract_all(str = ., regex = "[0-9]+")
ju <- substr(b[[1]][1], 1, 2)
}
ja <- ifelse(is.na(ju), NA, paste(ju, "pulgadas"))
}
if (length(ho) !=0){
ju <- stri_extract_all(regex = '\\d+( ?)p',
str = cadena,
case_insensitive = TRUE) %>%
stri_extract_all(regex = "[0-9]+") %>%
unlist()
ja <- ifelse(is.na(ju[1]), NA, paste(ju[1], "pies"))
}
if (length(he) !=0){
ju <- stri_extract_all(regex = '\\d+( ?)kg',
str = cadena,
case_insensitive = TRUE) %>%
stri_extract_all(regex = "[0-9]+")
ja <- ifelse(is.na(ju), NA, paste(ju, "Kg"))
}
return(ja)
}
df_Sub_coppel$marca <- sapply(df_Sub_coppel$Nombre,
function(cadena) extrae_marca(cadena, marcas))
df_Sub_coppel$Producto <- sapply(df_Sub_coppel$Nombre,
function(art) tipo_producto(art))
df_Sub_coppel$tamano <- sapply(df_Sub_coppel$Nombre,
function(cadena) extrae_tamano(cadena))
#para el data frame de famsa
df_Sub_famsa$marca <- sapply(df_Sub_famsa$Nombre_producto,
function(cadena) extrae_marca(cadena, marcas))
df_Sub_famsa$Producto <- sapply(df_Sub_famsa$Nombre_producto,
function(art) tipo_producto(art))
df_Sub_famsa$tamano <- sapply(df_Sub_famsa$Nombre_producto,
function(cadena) extrae_tamano(cadena))
View(df_Sub_coppel)
View(df_Sub_famsa)
df_Sub_famsa %>%
select(Nombre = Nombre_producto,
Precio = precio_contado,
Marca,
Producto,
Tamanio)
df_Sub_coppel$Marca <- sapply(df_Sub_coppel$Nombre,
function(cadena) extrae_marca(cadena, marcas))
df_Sub_coppel$Producto <- sapply(df_Sub_coppel$Nombre,
function(art) tipo_producto(art))
df_Sub_coppel$Tamanio <- sapply(df_Sub_coppel$Nombre,
function(cadena) extrae_tamano(cadena))
#para el data frame de famsa
df_Sub_famsa$Marca <- sapply(df_Sub_famsa$Nombre_producto,
function(cadena) extrae_marca(cadena, marcas))
df_Sub_famsa$Producto <- sapply(df_Sub_famsa$Nombre_producto,
function(art) tipo_producto(art))
df_Sub_famsa$Tamanio <- sapply(df_Sub_famsa$Nombre_producto,
function(cadena) extrae_tamano(cadena))
#para el data frame de ekt
df_ekt$Marca <- sapply(df_ekt$Nombre,
function(cadena) extrae_marca(cadena, marcas))
df_ekt$Producto <- sapply(df_ekt$Nombre,
function(art) tipo_producto(art))
df_ekt$Tamanio <- unlist(sapply(df_ekt$Nombre,
function(cadena) extrae_tamano_ekt(cadena)))
df_Sub_famsa %>%
select(Nombre = Nombre_producto,
Precio = precio_contado,
Marca,
Producto,
Tamanio)
df_Sub_famsa %>%
select(Nombre = Nombre_producto,
Precio = precio_contado,
Marca,
Producto,
Tamanio) %>%
filter(complete.cases(.))
x2 <- df_Sub_coppel %>%
select(Nombre,
Precio = Price_Contado,
Marca,
Producto,
Tamanio) %>%
filter(complete.cases(.))
x1 <- df_Sub_famsa %>%
select(Nombre = Nombre_producto,
Precio = precio_contado,
Marca,
Producto,
Tamanio) %>%
filter(complete.cases(.))
x3 <- df_ekt %>%
select(Nombre,
Precio,
Marca,
Producto,
Tamanio) %>%
filter(complete.cases(.))
df_ekt %>% names
x3 <- df_ekt %>%
select(Nombre,
Precio = Precio_rebaja,
Marca,
Producto,
Tamanio) %>%
filter(complete.cases(.))
x1 <- df_Sub_famsa %>%
select(Nombre = Nombre_producto,
Precio = precio_contado,
Marca,
Producto,
Tamanio) %>%
filter(complete.cases(.)) %>%
mutate(Tienda = "Famsa")
x2 <- df_Sub_coppel %>%
select(Nombre,
Precio = Price_Contado,
Marca,
Producto,
Tamanio) %>%
filter(complete.cases(.)) %>%
mutate(Tienda = "Coppel")
x3 <- df_ekt %>%
select(Nombre,
Precio = Precio_rebaja,
Marca,
Producto,
Tamanio) %>%
filter(complete.cases(.)) %>%
mutate(Tienda = "Elektra")
df_final <- rbind(x1, x2, x3)
View(df_final)
saveRDS(df_final, "productos_tiendas.RDS")
View(df_final)
